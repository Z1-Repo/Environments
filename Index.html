<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Environment Status Form</title>
    <style>
        /* Page Styling */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            background: linear-gradient(to right, #4e54c8, #8f94fb);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
        }
        h1 {
            margin: 20px;
            text-align: center;
        }
        .container {
            width: 90%;
            max-width: 1200px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            overflow: hidden;
        }
        th, td {
            padding: 12px;
            text-align: center;
        }
        th {
            background: rgba(0, 0, 0, 0.5);
        }
        input {
            padding: 8px;
            border-radius: 8px;
            border: none;
            outline: none;
        }
        button {
            margin: 10px;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        button:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        /* Responsive Design */
        @media (max-width: 768px) {
            table {
                font-size: 14px;
            }
            input {
                width: 90%;
            }
        }
    </style>
</head>
<body>
    <h1>Environment Build Tracker</h1>
    <div class="container">
        <!-- Input Table -->
        <table id="inputTable">
            <thead>
                <tr>
                    <th>S.no</th>
                    <th>Environment Name</th>
                    <th>Build Name</th>
                    <th>Developer</th>
                    <th>QA</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><input type="number" placeholder="1"></td>
                    <td><input type="text" placeholder="Staging"></td>
                    <td><input type="text" placeholder="v1.0"></td>
                    <td><input type="text" placeholder="John Doe"></td>
                    <td><input type="text" placeholder="Jane Doe"></td>
                </tr>
            </tbody>
        </table>
        <!-- Action Buttons -->
        <button onclick="addRow()">:heavy_plus_sign: Add Row</button>
        <button onclick="saveData()">:floppy_disk: Save Data</button>
        <button onclick="loadData()">:arrows_counterclockwise: Load Data</button>
        <!-- Display Table -->
        <h2>Saved Data:</h2>
        <table id="displayTable">
            <thead>
                <tr>
                    <th>S.no</th>
                    <th>Environment Name</th>
                    <th>Build Name</th>
                    <th>Developer</th>
                    <th>QA</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    <script>
        // GitHub Configuration (Replace these values with your info)
        const username = "Z1-Repo"; // Your GitHub username
        const repo = "Z1-Repo/Environments";           // Your repository name
        const branch = "main";                   // "main" or "master"
        const token = "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"; // Your GitHub access token
        const filePath = "Z1-Repo/Environments/data.csv";             // File path in the repo
        // Add a new row to the input table
        function addRow() {
            const table = document.querySelector("#inputTable tbody");
            const newRow = table.insertRow();
            for (let i = 0; i < 5; i++) {
                const cell = newRow.insertCell();
                cell.innerHTML = `<input type="text">`;
            }
        }
        // Fetch CSV file from GitHub
        async function fetchFile() {
            try {
                console.log("Fetching CSV from GitHub...");
                const response = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/${filePath}`, {
                    headers: { Authorization: `token ${token}` }
                });
                if (!response.ok) {
                    if (response.status === 404) {
                        console.warn("File not found. Creating a new one...");
                        return { content: "", sha: null };
                    }
                    throw new Error(`GitHub API error: ${response.statusText}`);
                }
                const data = await response.json();
                return { content: atob(data.content), sha: data.sha };
            } catch (error) {
                console.error("Error fetching CSV:", error);
                alert("Error fetching data. Check console.");
                return { content: "", sha: null };
            }
        }
        // Upload CSV to GitHub
        async function uploadFile(content, sha) {
            try {
                console.log("Uploading CSV to GitHub...");
                const response = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/${filePath}`, {
                    method: "PUT",
                    headers: {
                        Authorization: `token ${token}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        message: "Update data.csv",
                        content: btoa(content),
                        branch,
                        sha
                    })
                });
                if (!response.ok) {
                    throw new Error(`Upload failed: ${response.statusText}`);
                }
                alert(":white_check_mark: Data successfully saved!");
            } catch (error) {
                console.error("Upload error:", error);
                alert("Error saving data. Check console.");
            }
        }
        // Save table data to CSV and upload to GitHub
        async function saveData() {
            const rows = document.querySelectorAll("#inputTable tbody tr");
            let csvContent = "S.no,Environment Name,Build Name,Developer,QA\n";
            rows.forEach(row => {
                const values = Array.from(row.querySelectorAll("input")).map(input => input.value);
                csvContent += `${values.join(",")}\n`;
            });
            const { sha } = await fetchFile();
            await uploadFile(csvContent, sha);
        }
        // Load CSV data and display on the webpage
        async function loadData() {
            const { content } = await fetchFile();
            if (!content) return alert("No data found.");
            const rows = content.split("\n").slice(1).filter(row => row.trim() !== "");
            const tableBody = document.querySelector("#displayTable tbody");
            tableBody.innerHTML = "";
            rows.forEach(row => {
                const newRow = tableBody.insertRow();
                row.split(",").forEach(col => {
                    const cell = newRow.insertCell();
                    cell.textContent = col.trim();
                });
            });
            alert(":arrows_counterclockwise: Data loaded successfully!");
        }
    </script>
</body>
</html>
